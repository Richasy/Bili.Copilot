<?xml version="1.0" encoding="utf-8" ?>
<local:PlayerControlBase
    x:Class="BiliCopilot.UI.Controls.Core.PlayerInteractivePanel"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:ext="using:BiliCopilot.UI.Extensions"
    xmlns:ic="using:FluentIcons.WinUI"
    xmlns:local="using:BiliCopilot.UI.Controls.Core"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <local:PlayerControlBase.Resources>
        <Style
            x:Key="ContextMenuFlyoutItemStyle"
            BasedOn="{StaticResource DefaultMenuFlyoutItemStyle}"
            TargetType="MenuFlyoutItem">
            <Setter Property="MinWidth" Value="160" />
            <Setter Property="MinHeight" Value="40" />
        </Style>
        <Style
            x:Key="ContextMenuFlyoutSubItemStyle"
            BasedOn="{StaticResource DefaultMenuFlyoutSubItemStyle}"
            TargetType="MenuFlyoutSubItem">
            <Setter Property="MinWidth" Value="160" />
            <Setter Property="MinHeight" Value="40" />
        </Style>
    </local:PlayerControlBase.Resources>

    <FlyoutBase.AttachedFlyout>
        <MenuFlyout
            x:Name="ContextMenu"
            Closed="OnFlyoutClosed"
            Opened="OnFlyoutOpened">
            <MenuFlyoutItem
                Command="{x:Bind ViewModel.TakeScreenshotCommand, Mode=OneWay}"
                Style="{StaticResource ContextMenuFlyoutItemStyle}"
                Text="{ext:Locale Name=Screenshot}">
                <MenuFlyoutItem.Icon>
                    <ic:SymbolIcon Symbol="Screenshot" />
                </MenuFlyoutItem.Icon>
            </MenuFlyoutItem>
            <MenuFlyoutItem
                Command="{x:Bind ViewModel.TogglePanscanCommand, Mode=OneWay}"
                Style="{StaticResource ContextMenuFlyoutItemStyle}"
                Text="{x:Bind local:PlayerInteractivePanel.GetPanscanText(ViewModel.UsingPanscan), Mode=OneWay}">
                <MenuFlyoutItem.Icon>
                    <ic:SymbolIcon Symbol="ScanTable" />
                </MenuFlyoutItem.Icon>
            </MenuFlyoutItem>
            <MenuFlyoutItem
                Command="{x:Bind ViewModel.SendDanmakuCommand, Mode=OneWay}"
                Style="{StaticResource ContextMenuFlyoutItemStyle}"
                Text="{ext:Locale Name=SendDanmaku}">
                <MenuFlyoutItem.Icon>
                    <ic:SymbolIcon Symbol="TextBulletList" />
                </MenuFlyoutItem.Icon>
            </MenuFlyoutItem>
        </MenuFlyout>
    </FlyoutBase.AttachedFlyout>

    <Grid>
        <Rectangle
            HorizontalAlignment="Stretch"
            VerticalAlignment="Stretch"
            Fill="Transparent" />

        <Border Visibility="{x:Bind ViewModel.Player.IsCompactOverlay, Mode=OneWay, Converter={StaticResource BoolToVisibilityReverseConverter}}">
            <Border Visibility="{x:Bind ViewModel.IsControlsVisible, Mode=OneWay}">
                <Button
                    Margin="0,0,16,0"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Center"
                    AutomationProperties.Name="{ext:Locale Name=ShowMenu}"
                    Click="OnMenuButtonClick"
                    Style="{StaticResource SidePlayerButtonStyle}"
                    ToolTipService.ToolTip="{ext:Locale Name=ShowMenu}"
                    Visibility="{x:Bind ViewModel.IsTouchControlsVisible, Mode=OneWay}">
                    <ic:FluentIcon FontSize="14" Icon="HandPoint" />
                </Button>
            </Border>
        </Border>
    </Grid>
</local:PlayerControlBase>
